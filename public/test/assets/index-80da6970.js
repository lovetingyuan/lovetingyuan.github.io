import{e as ke,r as x,aO as z,aY as ee,s as l,aN as L,aa as Xe,b3 as F,bb as he,b9 as Fe,aH as G,a$ as we,b0 as U,b1 as _e,ad as ge,b2 as A,aS as Ge,aG as ye,a4 as W}from"./entries-49a38532-6be843d0.js";import{_ as S,a4 as Ue,bx as We,W as X,U as E,k as $,by as Ae,bz as Te,bA as qe,bB as Me,bC as Ve,bD as He,bE as Ke,br as Ce,$ as j,v as Ee,bF as Ze,bG as pe,S as Qe,bH as Se,bI as Ne,R as et,X as fe,ap as te}from"./reference-b1a48a0f-59bab03f.js";var tt="index-module_searchBlock__NfBmY",nt="index-module_breadcrumb__tmIXo",at="index-module_listWrapper__8JNuF";ke(".index-module_container__JwCjl{-webkit-box-orient:vertical;-webkit-box-direction:normal;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;height:90%}.index-module_searchBlock__NfBmY{margin:5px 0;padding:0 16px}.index-module_searchBlock__NfBmY .adm-search-bar{pointer-events:none}.index-module_breadcrumb__tmIXo{-webkit-box-align:center;-webkit-align-items:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:30px;overflow-x:auto;padding:0 20px;white-space:nowrap;width:100%}.index-module_breadcrumb__tmIXo .crumbs-item{font-size:14px}.index-module_breadcrumb__tmIXo .crumbs-item.root{color:var(--adm-color-primary)}.index-module_breadcrumb__tmIXo .crumbs-item .split{margin:0 8px}.index-module_breadcrumb__tmIXo .crumbs-item .pathName{color:var(--adm-color-primary)}.index-module_breadcrumb__tmIXo .crumbs-item .pathName.current{color:#131f31}.index-module_listWrapper__8JNuF{-webkit-box-flex:1;-webkit-flex:1;flex:1;overflow-y:auto;padding:0 20px}.index-module_buttonGroups__JnhbF{-webkit-box-pack:justify;-webkit-box-align:center;-webkit-align-items:center;align-items:center;color:var(--adm-color-primary,#00a0b4);display:-webkit-box;display:-webkit-flex;display:flex;font-size:14px;height:50px;-webkit-justify-content:space-between;justify-content:space-between;padding:5px 12px;width:100%}");var rt="index-module_item__eoUiw",lt="index-module_searchContainer__oYJL4";ke(".index-module_item__eoUiw{-webkit-box-align:center;-webkit-align-items:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;padding:12px 0}.index-module_item__eoUiw .desc{-webkit-box-flex:1;color:#131f31;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex:1;flex:1;-webkit-flex-wrap:wrap;flex-wrap:wrap;font-size:16px;font-weight:400;margin-left:14px;word-break:break-word}.index-module_item__eoUiw .desc-item{margin-right:10px}.index-module_item__eoUiw .desc-item.hasLink{color:var(--adm-color-primary);cursor:pointer;text-decoration:underline}.index-module_searchContainer__oYJL4{-webkit-box-orient:vertical;-webkit-box-direction:normal;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;height:100%}.index-module_searchContainer__oYJL4 .search{-webkit-box-align:center;-webkit-box-pack:justify;-webkit-align-items:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between;margin:20px 0 5px;padding:0 16px}.index-module_searchContainer__oYJL4 .searchBar{-webkit-box-flex:1;-webkit-flex:1;flex:1}.index-module_searchContainer__oYJL4 .searchConfirm{color:var(--text-color);-webkit-flex-shrink:0;flex-shrink:0;padding:0 10px}.index-module_searchContainer__oYJL4 .listWrapper{-webkit-box-flex:1;-webkit-flex:1;flex:1;overflow-y:auto;padding:0 20px}.index-module_searchContainer__oYJL4 .buttonGroups{-webkit-box-pack:justify;-webkit-box-align:center;-webkit-align-items:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:50px;-webkit-justify-content:space-between;justify-content:space-between;padding:5px 12px;width:100%}.index-module_searchContainer__oYJL4 .buttonGroups .adm-buttonl{width:-webkit-calc(50vw - 24px);width:calc(50vw - 24px)}");var it=["columns","item","selected","selectable","isLeaf"];function be(e,u){var d=ye(e);if(W){var c=W(e);u&&(c=F(c).call(c,function(o){return A(e,o).enumerable})),d.push.apply(d,c)}return d}function xe(e){for(var u=1;u<arguments.length;u++){var d,c,o=arguments[u]!=null?arguments[u]:{};u%2?G(d=be(Object(o),!0)).call(d,function(n){we(e,n,o[n])}):U?_e(e,U(o)):G(c=be(Object(o))).call(c,function(n){ge(e,n,A(o,n))})}return e}var Ie=function(e){var u=e.columns,d=e.item,c=e.selected,o=e.selectable,n=e.isLeaf,w=he(e,it);return l.createElement("div",{className:rt},o?l.createElement(Qe,{checked:!!c,onChange:function(i){w.onSelect(d,i)}}):null,l.createElement("div",{className:"desc",onClick:function(){o&&w.onSelect(d,!c)}},L(u).call(u,function(i){return l.createElement("span",{key:i.name,style:{marginRight:"4px"}},function(v,C){var f=Se(C,v.name);return l.createElement(Ne,{value:f,dataType:v==null?void 0:v.dataType,extra:xe(xe({},v),{},{field:v.key,record:C,relationEntity:v==null?void 0:v.relationEntity})})}(i,d)," ")})),n?null:l.createElement(Fe,{onClick:function(){var i;return w==null||(i=w.onChildren)===null||i===void 0?void 0:i.call(w,d)},name:"LinedRight",style:{color:"#C8C8C8",fontSize:16}}))},ot=["visible","dataReference","multiSelect","dataSource","columns","detailPage"],ct=function(e){var u=e.visible,d=e.dataReference,c=e.multiSelect,o=e.dataSource,n=e.columns,w=e.detailPage,i=he(e,ot),v=x.exports.useState([]),C=S(v,2),f=C[0],P=C[1],k=x.exports.useState(""),N=S(k,2),O=N[0],T=N[1],q=function(s){var h=te(f).call(f,function(R){return R.id===s.id});if(h>-1)Ge(f).call(f,h,1),P(ee(f).call(f));else{var _=[];c?(_=f).push(s):_.push(s),P(_)}};return l.createElement(et,{visible:u,bodyStyle:{height:"100vh"},style:{zIndex:1e4}},l.createElement("div",{className:lt},l.createElement("div",{className:"search"},l.createElement(Ce,{className:"searchBar",placeholder:j.t({k:"app_common.input",d:"请输入"}),clearable:!0,value:O,onChange:function(s){return T(s)},onSearch:function(s){var h;i==null||(h=i.onSearch)===null||h===void 0||h.call(i,s)}}),l.createElement("div",{className:"searchConfirm",onClick:function(){var s;i==null||(s=i.onSearch)===null||s===void 0||s.call(i,O)}},j.t({k:"common.search.label",d:"搜索"}))),l.createElement("div",{className:"listWrapper"},L(o).call(o,function(s){return l.createElement(Ie,{key:s.id,item:s,columns:n,selected:Ee(f).call(f,function(h){return h.id===s.id}),selectable:!0,onSelect:q,dataReference:d,isLeaf:!0,detailPage:w})})),l.createElement("div",{className:"buttonGroups"},l.createElement(fe,{block:!0,size:"large",fill:"outline",style:{marginRight:"8px"},onClick:function(){var s;i==null||(s=i.onCancel)===null||s===void 0||s.call(i)}},j.t({k:"common.button.cancel.label",d:"取消"})),l.createElement(fe,{block:!0,size:"large",disabled:!f.length,onClick:function(){var s;i==null||(s=i.onOk)===null||s===void 0||s.call(i,f)}},j.t({k:"common.button.ok.label",d:"确定"})))))};function ve(e,u){var d=ye(e);if(W){var c=W(e);u&&(c=F(c).call(c,function(o){return A(e,o).enumerable})),d.push.apply(d,c)}return d}function Q(e){for(var u=1;u<arguments.length;u++){var d,c,o=arguments[u]!=null?arguments[u]:{};u%2?G(d=ve(Object(o),!0)).call(d,function(n){we(e,n,o[n])}):U?_e(e,U(o)):G(c=ve(Object(o))).call(c,function(n){ge(e,n,A(o,n))})}return e}function dt(e){var u,d=e.multiSelect,c=d!==void 0&&d,o=e.onChange,n=e.dataReference,w=e.output,i=w===void 0?[]:w,v=e.pageProps,C=e.onOk,f=e.detailPage,P=e.selected,k=P===void 0?[]:P,N=v||{},O=N.uiModelParams,T=N.itemContext,q=N.execSyncWithCompile,s=x.exports.useState([]),h=S(s,2),_=h[0],R=h[1],$e=x.exports.useState([]),ne=S($e,2),Le=ne[0],je=ne[1],Pe=x.exports.useState(!1),ae=S(Pe,2),Je=ae[0],re=ae[1],Oe=x.exports.useState([]),le=S(Oe,2),g=le[0],M=le[1],ie=n.configInfo||{},oe=ie==null?void 0:ie.onlyLastLevel,I=(n==null||(u=n.configInfo)===null||u===void 0?void 0:u.columns)||[],Re=x.exports.useContext(Ue).appData,Ye=x.exports.useContext(We).pageId,Be=function(t){(function(a,r){c?(a?k.push(r):k=F(k).call(k,function(b){return(r==null?void 0:r.id)!==b.id}),o==null||o($(k))):o==null||o(a?[r]:[])})(!(te(k).call(k,function(a){return(a==null?void 0:a.id)===t.id})>-1),t)},ce=function(t,a){var r=Se(a,t.name);return l.createElement(Ne,{value:r,dataType:t==null?void 0:t.dataType,extra:Q(Q({},t),{},{field:t.name,record:a,relationEntity:t==null?void 0:t.relationEntity})})},De=function(){var t=X(E.mark(function a(r){var b,m;return E.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(M(function(B){var J;return z(J=[]).call(J,$(B),[{id:r.id,key:r.id,record:r,pathName:ce(I,r||{})}])}),(b=r.children)!==null&&b!==void 0&&b.length||r.isLeaf){y.next=6;break}return y.next=4,Y({treeParentId:r.id});case 4:m=y.sent,R(z(_).call(_,m));case 6:case"end":return y.stop()}},a)}));return function(a){return t.apply(this,arguments)}}(),se=x.exports.useMemo(function(){var t=ee(g).call(g,-1),a=S(t,1)[0];return _!=null&&_.length?Ae({flatData:_,rootId:a==null?void 0:a.id}):[]},[g,_]),ue=function(t){if(t){var a=te(g).call(g,function(r){return r.id===t.id});M(ee(g).call(g,0,a+1))}else M([])},Y=x.exports.useCallback(X(E.mark(function t(){var a,r,b,m,y,B,J,D,V,H,K,de,me,Z=arguments;return E.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(a=Z.length>0&&Z[0]!==void 0?Z[0]:{},r=a.treeParentId,b=r===void 0?"0":r,m=a.search,y=a.params,B=y===void 0?{}:y,p.prev=1,qe(n==null?void 0:n.appInfo),D={queryDto:Q({sqlModel:Me(He(n,i,f),Ve(n==null?void 0:n.appInfo)),sort:{orders:[{direction:"ASC",property:"archiveCode"}]},treeParentId:b,limit:1e3},B)},b==="0"&&m&&(D.queryDto.locationCond={archiveCaption:m}),p.prev=5,n==null||(V=n.configInfo)===null||V===void 0||!V.whereCond){p.next=13;break}if(!(K=JSON.parse(n==null||(H=n.configInfo)===null||H===void 0?void 0:H.whereCond))||!K.length){p.next=13;break}return p.next=11,Ke(K,O,T,q);case 11:de=p.sent,D.queryDto.filterCond=de;case 13:p.next=17;break;case 15:p.prev=15,p.t0=p.catch(5);case 17:return p.next=19,Te({columns:z(J=[]).call(J,$(I),$(i)),entityName:n==null?void 0:n.entityName,serverParams:D,appInfo:(n==null?void 0:n.appInfo)||{},dataReference:n,appData:Re,pageId:Ye});case 19:return me=p.sent,p.abrupt("return",me);case 23:return p.prev=23,p.t1=p.catch(1),p.abrupt("return",[]);case 26:case"end":return p.stop()}},t,null,[[1,23],[5,15]])})),[n,i,I]),ze=function(){var t=X(E.mark(function a(r){var b;return E.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,m.next=3,Y({search:r,params:{needParentAndBrother:!1,limit:1e3,extendCond:oe?{isLeaf:!0}:void 0}});case 3:b=m.sent,je(b),m.next=9;break;case 7:m.prev=7,m.t0=m.catch(0);case 9:case"end":return m.stop()}},a,null,[[0,7]])}));return function(a){return t.apply(this,arguments)}}();return x.exports.useEffect(function(){X(E.mark(function t(){var a;return E.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Y();case 2:a=r.sent,R(a);case 4:case"end":return r.stop()}},t)}))()},[Y]),l.createElement(x.exports.Fragment,null,l.createElement("div",{className:tt,onClick:function(){re(!0)}},l.createElement(Ce,{placeholder:j.t({k:"common.search.label",d:"搜索"})})),l.createElement("div",{className:nt},l.createElement("div",{key:"ROOT",className:"crumbs-item root",onClick:function(){return ue()}},j.t({k:"common.reference.rootDirectory",d:"根目录"})),L(g).call(g,function(t,a){return l.createElement("div",{key:t.key,className:"crumbs-item"},l.createElement("span",{className:"split"},"/"),l.createElement("span",{onClick:function(){return ue(t)},className:Xe("pathName",{current:a===g.length-1})},L(I).call(I,function(r){return l.createElement("span",{key:r.name,style:{marginRight:"4px"}},ce(r,(t==null?void 0:t.record)||{})," ")})))})),l.createElement("div",{className:at},L(se).call(se,function(t){var a;return l.createElement(Ie,{key:t.id,item:t,columns:(n==null||(a=n.configInfo)===null||a===void 0?void 0:a.columns)||[],selected:Ee(k).call(k,function(r){return(r==null?void 0:r.id)===t.id}),selectable:!(oe&&!t.isLeaf),onSelect:Be,dataReference:n,onChildren:De,isLeaf:t.isLeaf,detailPage:f,multiSelect:c})})),l.createElement(ct,{visible:Je,dataReference:n,columns:I,dataSource:Le,onCancel:function(){re(!1)},onSearch:ze,onOk:function(t){if(c){var a,r=new Ze(L(t).call(t,function(m){return[m.id,m]})),b=F(t).call(t,function(m){return!r.has(m.id)});C(pe(z(a=[]).call(a,$(t),$(b)),i))}else C(pe(t,i))},detailPage:f,multiSelect:c}))}export{dt as default};
