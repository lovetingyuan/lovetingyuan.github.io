import{r as s,a3 as Se,aN as X,b3 as G,aH as Z,b4 as ln,s as n,b9 as g,aa as P,a$ as on,b0 as De,b1 as rn,ad as sn,b2 as Re,aG as cn,a4 as ze}from"./entries-49a38532-6be843d0.js";import{_ as p,al as mn,W as Y,U as T,ay as un,an as N,az as dn,aF as fn,aH as pn,aI as V,X as vn,R as Ce,am as Ie,aO as Te,aP as wn,ao as gn,aJ as hn,ac as Pe,ae as Fe,ag as Nn,z as yn,$ as En}from"./reference-b1a48a0f-59bab03f.js";import{T as bn,d as Le}from"./FileIcon-b321a387-4a967004.js";var kn=function(t){var a=t.item,d=t.onDownload,f=t.showSize,o=t.onPreview,m=t.onRemove,q=t.fileType,F=t.showRemove,K=F!==void 0&&F,R=t.showDownload,$=t.appName;t.disabledPreview,t.disabledDownload,t.disabledRemove;var j=t.readonlyFontSize;if(q==="image")return n.createElement("div",{className:"img-item",style:{borderColor:"#D5D8E0"}},hn.test((a==null?void 0:a.fileName)||"")?n.createElement(bn,{src:"",className:P("img"),storageKey:a==null?void 0:a.storageKey,appName:$,onClick:function(v){v.stopPropagation(),o==null||o()}}):n.createElement("div",{className:P("image-file"),onClick:function(){return o==null?void 0:o()}},n.cloneElement(Le(Pe((a==null?void 0:a.fileName)||"")),{style:{fontSize:"24px"}}),n.createElement("div",{className:"file-name"},a==null?void 0:a.fileName),n.createElement("div",{className:"file-size"},Fe(a==null?void 0:a.fileSize))),n.createElement(g,{className:"del-file-icon",name:"FilledCloseCircle",onClick:function(v){v.stopPropagation(),m==null||m()}}));var O=j?{fontSize:"".concat(j,"px")}:{};return n.createElement(Nn.Item,{prefix:n.cloneElement(Le(Pe((a==null?void 0:a.fileName)||"")),{className:"file-icon"}),className:P("down-list-item")},n.createElement("div",{className:"list-item-content",onClick:function(v){v.stopPropagation(),o==null||o()}},n.createElement("div",{className:P("list-item-title"),style:O},a==null?void 0:a.fileName),f&&n.createElement("div",{className:P("list-item-description")},Fe(a==null?void 0:a.fileSize))),n.createElement("div",{className:"list-item-icon"},n.createElement(yn,{style:{"--gap":"16px"}},R&&n.createElement(g,{name:"LinedDownload",className:"down-icon",onClick:function(v){v.stopPropagation(),d==null||d(a)}}),K&&n.createElement(g,{name:"LinedDelete",className:"del-file-icon",onClick:function(){return m==null?void 0:m()}}))))};function Ke(t,a){var d=cn(t);if(ze){var f=ze(t);a&&(f=G(f).call(f,function(o){return Re(t,o).enumerable})),d.push.apply(d,f)}return d}function y(t){for(var a=1;a<arguments.length;a++){var d,f,o=arguments[a]!=null?arguments[a]:{};a%2?Z(d=Ke(Object(o),!0)).call(d,function(m){on(t,m,o[m])}):De?rn(t,De(o)):Z(f=Ke(Object(o))).call(f,function(m){sn(t,m,Re(o,m))})}return t}var w=En.t,zn=function(t){var a,d,f=t.storageKeys,o=f===void 0?[]:f,m=t.customItemRender,q=t.showRemove,F=t.onRemove,K=t.fileType,R=K===void 0?"list":K,$=t.showBatchDownload,j=$!==void 0&&$,O=t.showDownload,v=O===void 0||O,ee=t.showPreview,$e=ee===void 0||ee,x=t.disabledDownload,ne=t.disabledPreview,je=t.disabledRemove,L=t.appName,J=t.isTemplate,W=t.templateProps,Oe=s.exports.useState(!1),te=p(Oe,2),ae=te[0],le=te[1],Me=s.exports.useState(!1),ie=p(Me,2),Ae=ie[0],M=ie[1],Be=s.exports.useState(!1),oe=p(Be,2),Ge=oe[0],S=oe[1],qe=s.exports.useState([]),re=p(qe,2),E=re[0],_=re[1],Je=s.exports.useState({}),se=p(Je,2),D=se[0],ce=se[1],We=s.exports.useState(0),me=p(We,2),H=me[0],ue=me[1],_e=s.exports.useState(!0),de=p(_e,2);de[0];var Q=de[1],He=s.exports.useState(""),fe=p(He,2),z=fe[0],A=fe[1],U=s.exports.useRef(null),B=Se(a=navigator.userAgent).call(a,"m5shell")>=0,pe=Se(d=navigator.userAgent).call(d,"sf-service-mobile")>=0,Qe=s.exports.useRef(null),Ue=s.exports.useState(""),ve=p(Ue,2),Xe=ve[0];ve[1],s.exports.useRef(null),s.exports.useRef(!0),s.exports.useEffect(function(){Ye()},[]),s.exports.useEffect(function(){if(o.length>0){var l;_(X(l=G(o).call(o,function(e){return e==null?void 0:e.storageKey})).call(l,function(e){return y(y({},e),{},{fileName:(e==null?void 0:e.fileName)||(e==null?void 0:e.name),fileSize:(e==null?void 0:e.fileSize)||(e==null?void 0:e.size),name:(e==null?void 0:e.fileName)||(e==null?void 0:e.name),size:(e==null?void 0:e.fileSize)||(e==null?void 0:e.size)})}));var c={};Z(o).call(o,function(e,i){var u={lastFetchTime:0,url:"#"};typeof(o==null?void 0:o[0])=="string"?c[e]=u:c[e==null?void 0:e.storageKey]=u}),ce(c)}},[mn(o)]);var Ye=function(){var l=Y(T.mark(function c(){var e,i,u;return T.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e=localStorage.getItem("fileConfig"))){r.next=6;break}Q(!1),ue((i=JSON.parse(e))===null||i===void 0?void 0:i.downloadSignExpireTime),r.next=10;break;case 6:return r.next=8,un({appName:t.appName});case 8:(u=r.sent).content?(ue(u.content.downloadSignExpireTime),Q(!1),localStorage.setItem("fileConfig",ln(u.content))):console.error("获取文件服务的配置失败");case 10:case"end":return r.stop()}},c)}));return function(){return l.apply(this,arguments)}}(),Ve=function(){var l=Y(T.mark(function c(e,i){var u,r,C,I,ke,k,xe;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(((u=window.jsSdk.getEnv())==null?void 0:u.appName)!=="QYWX"&&(u==null?void 0:u.appName)!=="DINGDING"){h.next=4;break}return N.show({content:w({k:"common.ui.upload.dont.download",d:"当前环境不支持下载功能！"})}),h.abrupt("return");case 4:if(r=e.storageKey,C=D[r].lastFetchTime,I=H<60?H:60,!(H===0||C===0||new Date().getTime()-C>1e3*I)){h.next=14;break}return h.next=10,fn({appName:t.appName,storageKeys:r});case 10:(ke=h.sent).content?(k=dn("".concat(ke.content)),(xe=Object.create(null))[r]={url:k,lastFetchTime:new Date().getTime()},ce(y(y({},D),xe)),i?pe?window.jsSdk.media.previewImage({url:[k]}):B?window.jsSdk.routor.push({url:k}):(A(k),M(!0)):(A(k),B?we({filename:e.fileName,url:k,id:e.id,fileInfo:e}):(U.current.click(),S(!1),N.show({content:w({k:"common.mui.upload.save.success",d:"保存成功"})}))),Q(!1)):console.error("获取文件下载地址失败"),h.next=15;break;case 14:i?pe?window.jsSdk.media.previewImage({url:[D[r].url]}):B?window.jsSdk.routor.push({url:D[r].url}):(A(D[r].url),M(!0)):B?we({filename:e.fileName,url:D[r].url,id:e.id,fileInfo:e}):(U.current.click(),S(!1),N.show({content:w({k:"common.mui.upload.save.success",d:"保存成功"})}));case 15:case"end":return h.stop()}},c)}));return function(c,e){return l.apply(this,arguments)}}();function we(l){var c=l.filename,e=l.url,i=l.fileInfo;window.jsSdk.http.download({filename:c,url:e,requestId:i.id},function(u){JSON.parse(u),N.show({content:w({k:"common.mui.upload.save.success",d:"保存成功"})}),S(!1)},function(u){var r,C;r=i,C=X(E).call(E,function(I){return I.fileName===r.fileName?y(y({},I),{},{status:"error"}):y({},I)}),_(C),ge(r)})}function ge(l){window.jsSdk.http.cancel({requestIds:l.id})}var Ze=s.exports.useState(),he=p(Ze,2),b=he[0];he[1];var en=s.exports.useState(!1),Ne=p(en,2),ye=Ne[0];Ne[1];var nn=s.exports.useState(""),Ee=p(nn,2),tn=Ee[0];Ee[1],s.exports.useEffect(function(){ye&&N.show({icon:"loading"})},[ye]);var be=function(){var l=Y(T.mark(function c(e){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if($e){i.next=3;break}return N.show({icon:n.createElement(g,{name:"Linedtermination"}),content:w({k:"common.ui.upload.notsupport.preview",d:"不支持预览！"})}),i.abrupt("return");case 3:if(!ne){i.next=6;break}return N.show({icon:n.createElement(g,{name:"Linedtermination"}),content:w({k:"common.ui.upload.disabled.preview",d:"预览操作被禁用！"})}),i.abrupt("return");case 6:return pn({appName:L,file:e,showDownload:v,disabledPreview:ne,disabledDownload:x,isTemplate:J,templateProps:W}),i.abrupt("return");case 8:case"end":return i.stop()}},c)}));return function(c){return l.apply(this,arguments)}}(),an=function(l){if(je)N.show({content:w({k:"common.ui.upload.disabled.delete",d:"删除操作被禁用！"}),icon:n.createElement(g,{name:"Linedtermination"})});else{var c=G(E).call(E,function(i){return i.storageKey!==l.storageKey}),e=G(o).call(o,function(i){return(typeof i=="string"?i:i==null?void 0:i.storageKey)!==l.storageKey});_(c),F==null||F(e,l==null?void 0:l.storageKey)}};return n.createElement("div",null,n.createElement("div",{id:"list",className:P("file-list-wrapper",R==="image"?"img-list":"")},X(E).call(E,function(l,c){return m?function(e){return n.cloneElement(m==null?void 0:m(e,{download:function(){return V({fileList:[e],appName:L,disabledDownload:x})},preview:function(){return be(e)}}),{key:e.id})}(l):n.createElement(kn,y(y({},t),{},{fileType:R,onPreview:function(){return be(l)},onDownload:function(){x?N.show({content:w({k:"common.ui.upload.disabled.download",d:"下载操作被禁用！"}),icon:n.createElement(g,{name:"Linedtermination"})}):V({disabledDownload:x,appName:L,fileList:[l],isTemplate:J,templateProps:W})},onCancel:function(){return ge(l)},item:l,key:c,showSize:!0,showRemove:q,showDownload:v,onRemove:function(){return an(l)},appName:L}))})),!x&&v&&j&&E.length>0&&n.createElement("div",{className:"batch-download-btn"},n.createElement(vn,{size:"mini",btnType:"default",icon:"LinedBatchDownload",style:{margin:"8px 0 16px"},onClick:function(){V({disabledDownload:x,appName:L,fileList:E,isTemplate:J,templateProps:W,isBatch:!0})}},w({k:"common.mui.upload.all.download.btn",d:"全部下载"}))),n.createElement("a",{style:{display:"none"},ref:U,href:z,download:z,target:"downloadFileFrame"}),n.createElement("iframe",{src:z,style:{display:"none",border:0},name:"downloadFileFrame",id:"downloadFileFrame",width:"0",height:"0"}),ae&&n.createElement(Ce,{className:"down-upload-modal",bodyStyle:{height:"100vh"},visible:ae,destroyOnClose:!0,contentStyle:{display:"flex",flexDirection:"column"},onMaskClick:function(){le(!1),clearInterval(Qe.current)}},n.createElement(Ie,{backArrow:n.createElement(g,{name:"LinedLeftSmallM",style:{fontSize:"24px"}}),onBack:function(){le(!1)},right:n.createElement(g,{name:"FilledMore",style:{fontSize:"24px"},onClick:function(){return S(!0)}})},b==null?void 0:b.fileName),n.createElement("div",{className:"iframe-wrapper"},Xe==="fail"?n.createElement("div",{style:{height:100,textAlign:"center"}},n.createElement("div",null,"转换失败!")):n.createElement(Te,{appId:t==null?void 0:t.appName,style:{height:"100%"}},n.createElement("iframe",{name:"office_iframe",id:"office_iframe",src:tn,style:{width:"100%",height:"100%",border:"none"}})))),n.createElement(Ce,{className:"image-view-modal",bodyStyle:{height:"100vh"},visible:Ae,contentStyle:{display:"flex",flexDirection:"column"},onMaskClick:function(){M(!1),A("")}},n.createElement(Ie,{backArrow:n.createElement(g,{name:"LinedLeftSmallM",style:{fontSize:"24px"}}),onBack:function(){M(!1)},right:n.createElement(g,{style:{fontSize:"24px"},name:"FilledMore",onClick:function(){return S(!0)}})},b==null?void 0:b.fileName),n.createElement("div",{style:{flex:1}},n.createElement(Te,{appId:t==null?void 0:t.appName,style:{height:"100%"}},b&&z&&n.createElement("div",{className:"image-content"},wn.test(b==null?void 0:b.fileName)?n.createElement("video",{controls:!0,className:"image",src:z}):n.createElement("img",{className:"image",src:z}))))),n.createElement(gn,{visible:Ge,cancelText:w({k:"common.button.cancel.label",d:"取消"}),actions:[{text:w({k:"common.mui.upload.save.local",d:"保存到本地"}),key:"copy",onClick:function(){return Ve(b)}}],onClose:function(){return S(!1)}}))};export{zn as default};
