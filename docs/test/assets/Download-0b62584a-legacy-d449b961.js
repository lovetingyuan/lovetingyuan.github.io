System.register(["./entries-49a38532-legacy-a7c3725c.js","./reference-b1a48a0f-legacy-578a01e1.js","./FileIcon-b321a387-legacy-b7807a96.js"],(function(e,n){"use strict";var t,a,l,o,i,r,c,s,u,m,d,f,p,v,w,g,h,y,N,b,E,x,k,S,D,z,C,I,T,F,P,L,R,j,K,O,M,A,B,G;return{setters:[e=>{t=e.r,a=e.a3,l=e.aN,o=e.b3,i=e.aH,r=e.b4,c=e.s,s=e.b9,u=e.aa,m=e.a$,d=e.b0,f=e.b1,p=e.ad,v=e.b2,w=e.aG,g=e.a4},e=>{h=e._,y=e.al,N=e.W,b=e.U,E=e.ay,x=e.an,k=e.az,S=e.aF,D=e.aH,z=e.aI,C=e.X,I=e.R,T=e.am,F=e.aO,P=e.aP,L=e.ao,R=e.aJ,j=e.ac,K=e.ae,O=e.ag,M=e.z,A=e.$},e=>{B=e.T,G=e.d}],execute:function(){var n=function(e){var n=e.item,t=e.onDownload,a=e.showSize,l=e.onPreview,o=e.onRemove,i=e.fileType,r=e.showRemove,m=void 0!==r&&r,d=e.showDownload,f=e.appName;e.disabledPreview,e.disabledDownload,e.disabledRemove;var p=e.readonlyFontSize;if("image"===i)return c.createElement("div",{className:"img-item",style:{borderColor:"#D5D8E0"}},R.test((null==n?void 0:n.fileName)||"")?c.createElement(B,{src:"",className:u("img"),storageKey:null==n?void 0:n.storageKey,appName:f,onClick:function(e){e.stopPropagation(),null==l||l()}}):c.createElement("div",{className:u("image-file"),onClick:function(){return null==l?void 0:l()}},c.cloneElement(G(j((null==n?void 0:n.fileName)||"")),{style:{fontSize:"24px"}}),c.createElement("div",{className:"file-name"},null==n?void 0:n.fileName),c.createElement("div",{className:"file-size"},K(null==n?void 0:n.fileSize))),c.createElement(s,{className:"del-file-icon",name:"FilledCloseCircle",onClick:function(e){e.stopPropagation(),null==o||o()}}));var v=p?{fontSize:"".concat(p,"px")}:{};return c.createElement(O.Item,{prefix:c.cloneElement(G(j((null==n?void 0:n.fileName)||"")),{className:"file-icon"}),className:u("down-list-item")},c.createElement("div",{className:"list-item-content",onClick:function(e){e.stopPropagation(),null==l||l()}},c.createElement("div",{className:u("list-item-title"),style:v},null==n?void 0:n.fileName),a&&c.createElement("div",{className:u("list-item-description")},K(null==n?void 0:n.fileSize))),c.createElement("div",{className:"list-item-icon"},c.createElement(M,{style:{"--gap":"16px"}},d&&c.createElement(s,{name:"LinedDownload",className:"down-icon",onClick:function(e){e.stopPropagation(),null==t||t(n)}}),m&&c.createElement(s,{name:"LinedDelete",className:"del-file-icon",onClick:function(){return null==o?void 0:o()}}))))};function J(e,n){var t=w(e);if(g){var a=g(e);n&&(a=o(a).call(a,(function(n){return v(e,n).enumerable}))),t.push.apply(t,a)}return t}function _(e){for(var n=1;n<arguments.length;n++){var t,a,l=null!=arguments[n]?arguments[n]:{};n%2?i(t=J(Object(l),!0)).call(t,(function(n){m(e,n,l[n])})):d?f(e,d(l)):i(a=J(Object(l))).call(a,(function(n){p(e,n,v(l,n))}))}return e}var q=A.t;e("default",(function(e){var m,d,f=e.storageKeys,p=void 0===f?[]:f,v=e.customItemRender,w=e.showRemove,g=e.onRemove,R=e.fileType,j=void 0===R?"list":R,K=e.showBatchDownload,O=void 0!==K&&K,M=e.showDownload,A=void 0===M||M,B=e.showPreview,G=void 0===B||B,J=e.disabledDownload,H=e.disabledPreview,W=e.disabledRemove,X=e.appName,$=e.isTemplate,Q=e.templateProps,U=t.exports.useState(!1),Y=h(U,2),V=Y[0],Z=Y[1],ee=t.exports.useState(!1),ne=h(ee,2),te=ne[0],ae=ne[1],le=t.exports.useState(!1),oe=h(le,2),ie=oe[0],re=oe[1],ce=t.exports.useState([]),se=h(ce,2),ue=se[0],me=se[1],de=t.exports.useState({}),fe=h(de,2),pe=fe[0],ve=fe[1],we=t.exports.useState(0),ge=h(we,2),he=ge[0],ye=ge[1],Ne=t.exports.useState(!0),be=h(Ne,2);be[0];var Ee=be[1],xe=t.exports.useState(""),ke=h(xe,2),Se=ke[0],De=ke[1],ze=t.exports.useRef(null),Ce=a(m=navigator.userAgent).call(m,"m5shell")>=0,Ie=a(d=navigator.userAgent).call(d,"sf-service-mobile")>=0,Te=t.exports.useRef(null),Fe=t.exports.useState(""),Pe=h(Fe,2),Le=Pe[0];Pe[1],t.exports.useRef(null),t.exports.useRef(!0),t.exports.useEffect((function(){Re()}),[]),t.exports.useEffect((function(){if(p.length>0){var e;me(l(e=o(p).call(p,(function(e){return null==e?void 0:e.storageKey}))).call(e,(function(e){return _(_({},e),{},{fileName:(null==e?void 0:e.fileName)||(null==e?void 0:e.name),fileSize:(null==e?void 0:e.fileSize)||(null==e?void 0:e.size),name:(null==e?void 0:e.fileName)||(null==e?void 0:e.name),size:(null==e?void 0:e.fileSize)||(null==e?void 0:e.size)})})));var n={};i(p).call(p,(function(e,t){var a={lastFetchTime:0,url:"#"};"string"==typeof(null==p?void 0:p[0])?n[e]=a:n[null==e?void 0:e.storageKey]=a})),ve(n)}}),[y(p)]);var Re=function(){var n=N(b.mark((function n(){var t,a,l;return b.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t=localStorage.getItem("fileConfig"))){n.next=6;break}Ee(!1),ye(null===(a=JSON.parse(t))||void 0===a?void 0:a.downloadSignExpireTime),n.next=10;break;case 6:return n.next=8,E({appName:e.appName});case 8:(l=n.sent).content?(ye(l.content.downloadSignExpireTime),Ee(!1),localStorage.setItem("fileConfig",r(l.content))):console.error("获取文件服务的配置失败");case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),je=function(){var n=N(b.mark((function n(t,a){var l,o,i,r,c,s,u;return b.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("QYWX"!==(null==(l=window.jsSdk.getEnv())?void 0:l.appName)&&"DINGDING"!==(null==l?void 0:l.appName)){n.next=4;break}return x.show({content:q({k:"common.ui.upload.dont.download",d:"当前环境不支持下载功能！"})}),n.abrupt("return");case 4:if(o=t.storageKey,i=pe[o].lastFetchTime,r=he<60?he:60,!(0===he||0===i||(new Date).getTime()-i>1e3*r)){n.next=14;break}return n.next=10,S({appName:e.appName,storageKeys:o});case 10:(c=n.sent).content?(s=k("".concat(c.content)),(u=Object.create(null))[o]={url:s,lastFetchTime:(new Date).getTime()},ve(_(_({},pe),u)),a?Ie?window.jsSdk.media.previewImage({url:[s]}):Ce?window.jsSdk.routor.push({url:s}):(De(s),ae(!0)):(De(s),Ce?Ke({filename:t.fileName,url:s,id:t.id,fileInfo:t}):(ze.current.click(),re(!1),x.show({content:q({k:"common.mui.upload.save.success",d:"保存成功"})}))),Ee(!1)):console.error("获取文件下载地址失败"),n.next=15;break;case 14:a?Ie?window.jsSdk.media.previewImage({url:[pe[o].url]}):Ce?window.jsSdk.routor.push({url:pe[o].url}):(De(pe[o].url),ae(!0)):Ce?Ke({filename:t.fileName,url:pe[o].url,id:t.id,fileInfo:t}):(ze.current.click(),re(!1),x.show({content:q({k:"common.mui.upload.save.success",d:"保存成功"})}));case 15:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();function Ke(e){var n=e.filename,t=e.url,a=e.fileInfo;window.jsSdk.http.download({filename:n,url:t,requestId:a.id},(function(e){JSON.parse(e),x.show({content:q({k:"common.mui.upload.save.success",d:"保存成功"})}),re(!1)}),(function(e){var n,t;n=a,t=l(ue).call(ue,(function(e){return e.fileName===n.fileName?_(_({},e),{},{status:"error"}):_({},e)})),me(t),Oe(n)}))}function Oe(e){window.jsSdk.http.cancel({requestIds:e.id})}var Me=t.exports.useState(),Ae=h(Me,2),Be=Ae[0];Ae[1];var Ge=t.exports.useState(!1),Je=h(Ge,2),_e=Je[0];Je[1];var qe=t.exports.useState(""),He=h(qe,2),We=He[0];He[1],t.exports.useEffect((function(){_e&&x.show({icon:"loading"})}),[_e]);var Xe=function(){var e=N(b.mark((function e(n){return b.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=3;break}return x.show({icon:c.createElement(s,{name:"Linedtermination"}),content:q({k:"common.ui.upload.notsupport.preview",d:"不支持预览！"})}),e.abrupt("return");case 3:if(!H){e.next=6;break}return x.show({icon:c.createElement(s,{name:"Linedtermination"}),content:q({k:"common.ui.upload.disabled.preview",d:"预览操作被禁用！"})}),e.abrupt("return");case 6:return D({appName:X,file:n,showDownload:A,disabledPreview:H,disabledDownload:J,isTemplate:$,templateProps:Q}),e.abrupt("return");case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return c.createElement("div",null,c.createElement("div",{id:"list",className:u("file-list-wrapper","image"===j?"img-list":"")},l(ue).call(ue,(function(t,a){return v?function(e){return c.cloneElement(null==v?void 0:v(e,{download:function(){return z({fileList:[e],appName:X,disabledDownload:J})},preview:function(){return Xe(e)}}),{key:e.id})}(t):c.createElement(n,_(_({},e),{},{fileType:j,onPreview:function(){return Xe(t)},onDownload:function(){J?x.show({content:q({k:"common.ui.upload.disabled.download",d:"下载操作被禁用！"}),icon:c.createElement(s,{name:"Linedtermination"})}):z({disabledDownload:J,appName:X,fileList:[t],isTemplate:$,templateProps:Q})},onCancel:function(){return Oe(t)},item:t,key:a,showSize:!0,showRemove:w,showDownload:A,onRemove:function(){return function(e){if(W)x.show({content:q({k:"common.ui.upload.disabled.delete",d:"删除操作被禁用！"}),icon:c.createElement(s,{name:"Linedtermination"})});else{var n=o(ue).call(ue,(function(n){return n.storageKey!==e.storageKey})),t=o(p).call(p,(function(n){return("string"==typeof n?n:null==n?void 0:n.storageKey)!==e.storageKey}));me(n),null==g||g(t,null==e?void 0:e.storageKey)}}(t)},appName:X}))}))),!J&&A&&O&&ue.length>0&&c.createElement("div",{className:"batch-download-btn"},c.createElement(C,{size:"mini",btnType:"default",icon:"LinedBatchDownload",style:{margin:"8px 0 16px"},onClick:function(){z({disabledDownload:J,appName:X,fileList:ue,isTemplate:$,templateProps:Q,isBatch:!0})}},q({k:"common.mui.upload.all.download.btn",d:"全部下载"}))),c.createElement("a",{style:{display:"none"},ref:ze,href:Se,download:Se,target:"downloadFileFrame"}),c.createElement("iframe",{src:Se,style:{display:"none",border:0},name:"downloadFileFrame",id:"downloadFileFrame",width:"0",height:"0"}),V&&c.createElement(I,{className:"down-upload-modal",bodyStyle:{height:"100vh"},visible:V,destroyOnClose:!0,contentStyle:{display:"flex",flexDirection:"column"},onMaskClick:function(){Z(!1),clearInterval(Te.current)}},c.createElement(T,{backArrow:c.createElement(s,{name:"LinedLeftSmallM",style:{fontSize:"24px"}}),onBack:function(){Z(!1)},right:c.createElement(s,{name:"FilledMore",style:{fontSize:"24px"},onClick:function(){return re(!0)}})},null==Be?void 0:Be.fileName),c.createElement("div",{className:"iframe-wrapper"},"fail"===Le?c.createElement("div",{style:{height:100,textAlign:"center"}},c.createElement("div",null,"转换失败!")):c.createElement(F,{appId:null==e?void 0:e.appName,style:{height:"100%"}},c.createElement("iframe",{name:"office_iframe",id:"office_iframe",src:We,style:{width:"100%",height:"100%",border:"none"}})))),c.createElement(I,{className:"image-view-modal",bodyStyle:{height:"100vh"},visible:te,contentStyle:{display:"flex",flexDirection:"column"},onMaskClick:function(){ae(!1),De("")}},c.createElement(T,{backArrow:c.createElement(s,{name:"LinedLeftSmallM",style:{fontSize:"24px"}}),onBack:function(){ae(!1)},right:c.createElement(s,{style:{fontSize:"24px"},name:"FilledMore",onClick:function(){return re(!0)}})},null==Be?void 0:Be.fileName),c.createElement("div",{style:{flex:1}},c.createElement(F,{appId:null==e?void 0:e.appName,style:{height:"100%"}},Be&&Se&&c.createElement("div",{className:"image-content"},P.test(null==Be?void 0:Be.fileName)?c.createElement("video",{controls:!0,className:"image",src:Se}):c.createElement("img",{className:"image",src:Se}))))),c.createElement(L,{visible:ie,cancelText:q({k:"common.button.cancel.label",d:"取消"}),actions:[{text:q({k:"common.mui.upload.save.local",d:"保存到本地"}),key:"copy",onClick:function(){return je(Be)}}],onClose:function(){return re(!1)}}))}))}}}));
